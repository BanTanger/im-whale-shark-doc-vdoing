---
title: 消息存储
date: 2023-08-04 12:49:40
permalink: /pages/ad6b92/
---
## 消息存储

### 数据结构设计
必须要有 msgID 作为消息的唯一标识, 其必须满足四个特性

1. 全局唯一: 不能出现重复的 ID 号，既然是唯一标识，这是最基本的要求
2. 趋势递增: 在 MySQL InnoDB 引擎中使用的是聚集索引，由于多数 RDBMS 使用 B-tree 的数据结构来存储索引数据，在主键的选择上面我们应该尽量使用有序的主键保证写入性能。
3. 单调递增: 保证下一个 ID 一定大于上一个 ID，例如事务版本号，IM 增量消息、排序等等
4. 非连续: 如果 ID 是连续的，那么恶意用户就能轻易的编写程序扒取信息了，因此需要 ID 无规则、不规则

其中 2、3 的特性是为了实现消息的可排序性，即生成的 ID 应该具有可排序性，以便根据 ID 的顺序进行查询和排序操作。虽说 create_time 也能做排序，但为其建立索引是一个比较愚笨的操作，索引的维护成本也比较大

### 生成方式

### 存储方式
异步存储，消息先通过服务端做校验做同步，再异步存储到数据库里

### 云端